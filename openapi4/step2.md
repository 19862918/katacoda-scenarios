###  Создание новой версии
Предположим, текущая версия нашего демонстрационного api Содержит ошибку. Мы хотим выкатить фикс с использованием канареечного деплоя.
Создадим еще одну функцию из темплейта, которая будет возвращать текст "Version_2":

`faas-cli new --lang python3-sbercode apiv2 && sed -i 's/Hello from OpenFaaS!/Version_2/' ~/apiv2/handler.py &&  sed -i 's/Hello from OpenFaaS!/Version_2/' ~/apiv2/handler_test.py && faas-cli up -f apiv2.yml`{{execute}}

Дождемся, пока статус пода станет Ready.  
`kubectl wait -n openfaas-fn --for=condition=ContainersReady --timeout=5m --all pods`{{execute}}  

### Публикация новой версии

Канареечны деплой предполагает что на новую версию функции будет перенаправлен небольшой % запросов для оценки стабильности работы.
Перенаправим 10% траффика на новую версию.

Откроем интерфейс gravitee apim по ссылке [gravitee ](https://[[HOST_SUBDOMAIN]]-32100-[[KATACODA_HOST]].environments.katacoda.com/)  и авторизуемся в нем  
```
права администратора
user: admin
pasword: admin

```

Переходим на страницу нашего апи и добавляем еще один бэкенд (новая версия) с весом 1. Вес текущей версии указываем 9. Таким образом 90% траффика остается на текущей версии и 10% направляется на новую. Сохраняем изменения и публикуем их.